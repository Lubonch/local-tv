<div class="folder-selector-container">
  <div class="content">
    <h1 class="title">Local TV</h1>
    <p class="subtitle">Tu canal personal de videos</p>

    @if (!isSupported) {
      <div class="error-box">
        <p>{{ error }}</p>
      </div>
    }

    @if (isSupported) {
      @if (!isLoading && videoCount === 0) {
        <div class="action-box">
          <p class="instruction">Selecciona una carpeta con videos para comenzar</p>
          <button class="select-button" (click)="onSelectFolder()">
            Seleccionar Carpeta
          </button>

          <!-- Sección de Comerciales (Opcional) -->
          <div class="ads-section">
            <h3 class="ads-title">Comerciales (Opcional)</h3>
            
            <div class="ads-checkbox-container">
              <label class="checkbox-label">
                <input 
                  type="checkbox" 
                  [(ngModel)]="adsEnabled"
                  (change)="onAdsEnabledChange()"
                  class="ads-checkbox"
                />
                <span>Activar intercalado de comerciales</span>
              </label>
            </div>

            @if (adsEnabled) {
              <div class="ads-controls">
                <div class="ads-frequency-container">
                  <label class="frequency-label">
                    Cada cuántos videos:
                    <input 
                      type="number" 
                      min="1" 
                      max="10" 
                      [(ngModel)]="adsFrequency"
                      (change)="onAdsFrequencyChange()"
                      class="frequency-input"
                    />
                  </label>
                  <span class="frequency-hint">videos normales</span>
                </div>

                <button class="ads-select-button" (click)="onSelectAdsFolder()">
                  @if (adsVideoCount === 0) {
                    Seleccionar Carpeta de Comerciales
                  } @else {
                    Cambiar Carpeta ({{ adsVideoCount }} comerciales)
                  }
                </button>

                @if (adsVideoCount > 0) {
                  <div class="ads-info">
                    <p class="ads-count">✓ {{ adsVideoCount }} comerciales cargados</p>
                    <p class="ads-detail">Se reproducirán 1-5 comerciales aleatorios cada {{ adsFrequency }} videos</p>
                    <button class="ads-clear-button" (click)="clearAdsFolder()">
                      Limpiar comerciales
                    </button>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      }

      @if (isLoading) {
        <div class="loading-box">
          <div class="spinner"></div>
          <p class="loading-text">{{ loadingMessage }}</p>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="loadingProgress"></div>
          </div>
          <p class="progress-percentage">{{ loadingProgress }}%</p>
          <button class="cancel-button" (click)="cancelLoading()">
            Cancelar y seleccionar manualmente
          </button>
        </div>
      }

      @if (error && !isLoading) {
        <div class="error-box">
          <p>{{ error }}</p>
          <button class="retry-button" (click)="onSelectFolder()">
            Intentar de nuevo
          </button>
        </div>
      }

      @if (videoCount > 0 && !isLoading) {
        <div class="success-box">
          <p class="success-message">Se cargaron {{ videoCount }} videos</p>
          <p class="small-text">Iniciando reproducción...</p>
        </div>
      }
    }
  </div>
</div>
